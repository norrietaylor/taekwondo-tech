<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Game - Step by Step</title>
    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
            background: #2c5f5d;
            color: white;
        }
        
        #debug {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
        }
        
        canvas {
            border: 2px solid #1a3d3b;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>üîç Game Debug - Step by Step</h1>
    
    <div id="debug">
        <div id="log">Starting debug session...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <script>
        const debugLog = document.getElementById('log');
        function log(message) {
            debugLog.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        // Capture all console messages
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            log('LOG: ' + args.join(' '));
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            log('ERROR: ' + args.join(' '));
            originalError.apply(console, args);
        };
        
        // Listen for uncaught errors
        window.addEventListener('error', function(e) {
            log('UNCAUGHT ERROR: ' + e.message + ' at ' + e.filename + ':' + e.lineno);
        });
        
        log('Phaser loaded: ' + !!window.Phaser);
    </script>
    
    <!-- Load game scripts in order -->
    <script src="js/utils/Controls.js"></script>
    <script>log('‚úÖ Controls.js loaded');</script>
    
    <script src="js/utils/SaveSystem.js"></script>
    <script>log('‚úÖ SaveSystem.js loaded');</script>
    
    <script src="js/entities/Player.js"></script>
    <script>log('‚úÖ Player.js loaded');</script>
    
    <script src="js/entities/Enemy.js"></script>
    <script>log('‚úÖ Enemy.js loaded');</script>
    
    <script src="js/entities/Collectible.js"></script>
    <script>log('‚úÖ Collectible.js loaded');</script>
    
    <!-- Debug GameScene with extra logging -->
    <script>
        log('Creating debug GameScene...');
        
        class DebugGameScene extends Phaser.Scene {
            constructor() {
                super({ key: 'DebugGameScene' });
                log('DebugGameScene constructor called');
            }

            create() {
                log('DebugGameScene.create() started');
                
                try {
                    // Simple background first
                    log('Creating simple background...');
                    this.add.rectangle(512, 288, 1024, 576, 0x87ceeb);
                    log('‚úÖ Background created');
                    
                    // Add some text to verify rendering
                    log('Adding test text...');
                    this.add.text(512, 100, 'DEBUG GAME SCENE', {
                        fontSize: '32px',
                        fill: '#ffffff',
                        fontWeight: 'bold'
                    }).setOrigin(0.5);
                    log('‚úÖ Text added');
                    
                    // Add simple player representation
                    log('Creating simple player...');
                    const player = this.add.rectangle(512, 400, 32, 48, 0x4a9eff);
                    this.physics.add.existing(player);
                    log('‚úÖ Player created');
                    
                    // Add some platforms
                    log('Creating platforms...');
                    const platforms = this.physics.add.staticGroup();
                    
                    // Ground
                    for (let x = 0; x < 1024; x += 128) {
                        const ground = this.add.rectangle(x + 64, 576 - 32, 128, 64, 0xb0e0e6);
                        this.physics.add.existing(ground, true);
                        platforms.add(ground);
                    }
                    log('‚úÖ Platforms created');
                    
                    // Collision
                    this.physics.add.collider(player, platforms);
                    log('‚úÖ Collisions set up');
                    
                    // Camera
                    this.cameras.main.setBounds(0, 0, 1024, 576);
                    log('‚úÖ Camera bounds set');
                    
                    // Success message
                    this.add.text(512, 200, 'Game Scene Loaded Successfully!', {
                        fontSize: '24px',
                        fill: '#00ff00',
                        fontWeight: 'bold'
                    }).setOrigin(0.5);
                    
                    log('üéâ DebugGameScene created successfully!');
                    
                } catch (error) {
                    log('üí• ERROR in DebugGameScene.create(): ' + error.message);
                    log('Stack: ' + error.stack);
                }
            }
        }
        
        log('DebugGameScene class defined');
    </script>
    
    <script src="js/scenes/MenuScene.js"></script>
    <script>log('‚úÖ MenuScene.js loaded');</script>
    
    <script src="js/scenes/CraftScene.js"></script>
    <script>log('‚úÖ CraftScene.js loaded');</script>
    
    <script>
        log('Creating debug game configuration...');
        
        const debugConfig = {
            type: Phaser.AUTO,
            width: 1024,
            height: 576,
            parent: document.body,
            backgroundColor: '#2c5f5d',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 800 },
                    debug: false
                }
            },
            scene: [MenuScene, DebugGameScene, CraftScene]
        };
        
        // Create game instance with debug scene
        log('Initializing debug game...');
        
        setTimeout(() => {
            try {
                const game = new Phaser.Game(debugConfig);
                
                // Override MenuScene's startNewGame to go to DebugGameScene
                setTimeout(() => {
                    if (game.scene.scenes.length > 0) {
                        const menuScene = game.scene.getScene('MenuScene');
                        if (menuScene) {
                            const originalStartNewGame = menuScene.startNewGame;
                            menuScene.startNewGame = function() {
                                log('üéØ Starting DebugGameScene instead of GameScene');
                                this.scene.start('DebugGameScene');
                            };
                            log('‚úÖ MenuScene override applied');
                        }
                    }
                }, 1000);
                
                log('üéÆ Debug game created successfully');
            } catch (error) {
                log('üí• Failed to create debug game: ' + error.message);
                log('Stack: ' + error.stack);
            }
        }, 500);
    </script>
</body>
</html>
